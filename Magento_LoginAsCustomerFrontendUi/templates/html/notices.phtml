<?php
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes 2020-present. All rights reserved.
 * This product is licensed per Magento install
 * See https://hyva.io/license
 */

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;
use Magento\LoginAsCustomerFrontendUi\ViewModel\Configuration;

/**
 * @var Template $block
 * @var Escaper $escaper
 * @var ViewModelRegistry $viewModels
 */
$viewFileUrl = $block->getViewFileUrl('Magento_LoginAsCustomerFrontendUi::images/magento-icon.svg');

/** @var Configuration $configurationViewModel */
$configurationViewModel = $viewModels->require(Configuration::class);
if (!$configurationViewModel->isEnabled()) {
    return;
}
?>
<div class="bg-pos-blue"
     x-data="initLoginAsCustomer()"
     @private-content-loaded.window="receiveCustomerData(event.detail.data)"
>
    <div id="LoginAsCustomer" class="container mx-auto py-1 px-1 sm:px-6 lg:px-8" x-show="isVisible">
        <div class="flex items-center justify-between flex-wrap">
            <div class="w-0 flex-1 flex items-center">
                <span class="flex p-3">
                    <svg  fill="white" width="180px" version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 180 43.9" style="enable-background:new 0 0 180 43.9;" xml:space="preserve">
<path class="st0" d="M48.9,11.2c1.7,0.8,3,1.8,3.9,3.3s1.4,3.1,1.4,4.9s-0.5,3.6-1.4,4.9c-0.9,1.4-2.3,2.5-3.9,3.3
	c-1.7,0.8-3.7,1.1-6,1.1h-3.6v6.1H31V10h11.9C45.2,10,47.2,10.4,48.9,11.2z M44.9,21.5c0.6-0.5,0.8-1.2,0.8-2.1s-0.3-1.6-0.8-2.1
	c-0.6-0.5-1.4-0.8-2.6-0.8h-3v5.8h3C43.5,22.3,44.3,22,44.9,21.5z"/>
<path class="st0" d="M77.6,28.5v6.3H56.9V10h20.2v6.3H65.2v2.9h10.5v6H65.2v3.3C65.2,28.5,77.6,28.5,77.6,28.5z"/>
<path class="st0" d="M105.3,10v24.8h-6.9L89,23.6v11.2h-8.1V10h6.9l9.4,11.2V10H105.3z"/>
<path class="st0" d="M125.8,12.2c1.8,1.5,2.7,3.5,2.7,6.1s-0.9,4.6-2.7,6.1s-4.2,2.2-7.3,2.2h-7.1v8.1h-1.8V10h8.9
	C121.6,10,124.1,10.7,125.8,12.2L125.8,12.2z M124.5,23.3c1.4-1.1,2.1-2.8,2.1-4.9s-0.7-3.8-2.1-5s-3.4-1.7-6.1-1.7h-7.1v13.4h7.1
	C121.1,25.1,123.1,24.5,124.5,23.3L124.5,23.3z"/>
<path class="st0" d="M138.8,33.3c-2-1.1-3.5-2.6-4.6-4.5s-1.7-4-1.7-6.4s0.5-4.5,1.7-6.4c1.1-1.9,2.7-3.4,4.6-4.5
	c2-1.1,4.2-1.7,6.6-1.7s4.6,0.5,6.6,1.6s3.5,2.6,4.6,4.5c1.1,1.9,1.7,4,1.7,6.4s-0.5,4.5-1.7,6.4c-1.1,1.9-2.7,3.4-4.6,4.5
	c-2,1.1-4.2,1.6-6.6,1.6s-4.6-0.5-6.6-1.7V33.3z M151.1,31.9c1.7-1,3-2.3,4-3.9c1-1.7,1.4-3.5,1.4-5.6s-0.5-3.9-1.4-5.6
	c-1-1.7-2.3-3-4-3.9c-1.7-1-3.6-1.4-5.6-1.4s-4,0.5-5.6,1.4c-1.7,1-3,2.3-4,3.9c-1,1.7-1.4,3.5-1.4,5.6s0.5,3.9,1.4,5.6
	c1,1.7,2.3,3,4,3.9c1.7,1,3.6,1.4,5.6,1.4S149.4,32.9,151.1,31.9z"/>
<path class="st0" d="M165.9,34c-1.7-0.7-2.9-1.4-3.9-2.4l0.8-1.4c0.9,0.9,2,1.7,3.5,2.3c1.5,0.6,3,0.9,4.6,0.9
	c2.4,0,4.2-0.5,5.4-1.4s1.8-2.1,1.8-3.5c0-1.4-0.3-2-1-2.7c-0.7-0.7-1.4-1.2-2.4-1.5c-1-0.4-2.2-0.7-3.8-1.1
	c-1.8-0.5-3.3-0.9-4.4-1.3c-1.1-0.4-2-1.1-2.8-2c-0.8-0.9-1.1-2.1-1.1-3.6s0.3-2.3,1-3.3s1.6-1.8,2.9-2.4c1.3-0.6,3-0.9,4.9-0.9
	c2,0,2.7,0.2,4,0.6c1.3,0.4,2.4,1,3.4,1.6l-0.7,1.4c-1-0.7-2.1-1.2-3.3-1.5s-2.4-0.5-3.5-0.5c-2.3,0-4,0.5-5.2,1.4s-1.8,2.1-1.8,3.6
	c0,1.4,0.3,2,1,2.7c0.7,0.7,1.4,1.2,2.4,1.5c1,0.4,2.3,0.7,3.9,1.1c1.8,0.5,3.3,0.9,4.3,1.3s2,1.1,2.8,1.9c0.8,0.9,1.1,2,1.1,3.5
	c0,1.5-0.3,2.3-1,3.3c-0.7,1-1.7,1.8-3,2.4c-1.4,0.6-3,0.9-4.9,0.9c-2,0-3.6-0.3-5.2-1L165.9,34z"/>
<path class="st0" d="M26.2,15.2c-1.2-2-2.9-3.5-5-4.6S16.6,8.9,14,8.9s-5.1,0.5-7.2,1.7s-3.8,2.7-5,4.6S0,19.4,0,21.9
	s0.6,4.7,1.8,6.7s2.9,3.5,5,4.6c2.1,1.1,4.5,1.7,7.2,1.7s5.1-0.5,7.2-1.7c2.1-1.1,3.8-2.7,5-4.6s1.8-4.2,1.8-6.7
	S27.3,17.2,26.2,15.2z M13.5,28.1v-6.2l-5.4-3.3c1.1-1.8,3.1-3,5.4-3c3.4,0,6.2,2.8,6.2,6.2S16.9,28.2,13.5,28.1L13.5,28.1z"/>
</svg>
                </span>
                <p class="ml-3 font-bold text-white truncate border-l pl-6">
                    <span x-text="notificationText"></span> <span class="font-normal"> is currently being served</span>
                </p>
            </div>
            <div class="order-2 shrink-0 sm:order-3 sm:ml-3">
                <?= $block->getChildHtml('login-as-customer-notice-links') ?>
            </div>
        </div>
    </div>
</div>

<script>
    "use strict";

    function initLoginAsCustomer() {
        return {
            isVisible: false,
            adminUserId: null,
            websiteName: null,
            fullname: null,
            notificationText: '',
            receiveCustomerData: function receiveCustomerData(data) {
                if (data.customer) {
                    this.fullname = data.customer.fullname;
                }

                if (data.loggedAsCustomer) {
                    this.adminUserId = data.loggedAsCustomer.adminUserId;
                    this.websiteName = data.loggedAsCustomer.websiteName;
                }

                this.updateBanner();
            },

            updateBanner: function updateBanner() {
                this.isVisible = !!this.adminUserId;

                if (this.fullname !== undefined && this.websiteName !== undefined) {
                    this.notificationText = '<?=
                        $escaper->escapeHtml(__('<strong>%1</strong> '), ['<strong>']) ?>'
                        .replace('%1', this.fullname)
                        .replace('%2', this.websiteName);
                }
            }
        }
    }
</script>
