<?php
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes 2020-present. All rights reserved.
 * This product is licensed per Magento install
 * See https://hyva.io/license
 */

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;
use Magento\LoginAsCustomerFrontendUi\ViewModel\Configuration;

/**
 * @var Template $block
 * @var Escaper $escaper
 * @var ViewModelRegistry $viewModels
 */
$viewFileUrl = $block->getViewFileUrl('Magento_LoginAsCustomerFrontendUi::images/magento-icon.svg');

/** @var Configuration $configurationViewModel */
$configurationViewModel = $viewModels->require(Configuration::class);
if (!$configurationViewModel->isEnabled()) {
    return;
}
?>
<div class="bg-pos-blue"
     x-data="initLoginAsCustomer()"
     @private-content-loaded.window="receiveCustomerData(event.detail.data)"
>
    <div id="LoginAsCustomer" class="container mx-auto py-1 px-1 sm:px-6 lg:px-8" x-show="isVisible">
        <div class="flex items-center justify-between flex-wrap">
            <div class="w-0 flex-1 flex items-center">
                <span class="flex p-3">
                   
                    <svg width="180px" id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 302.8 43.9"><defs><style>.cls-1{fill:#fff;stroke-width:0px;}</style></defs><path class="cls-1" d="m82.3,3.8c2.9,1.3,5.1,3.1,6.6,5.5,1.5,2.4,2.3,5.2,2.3,8.3s-.8,6-2.3,8.3c-1.5,2.4-3.8,4.2-6.6,5.5s-6.2,1.9-10.1,1.9h-6v10.2h-14.1V1.9h20.1c3.9,0,7.2.6,10.1,1.9Zm-6.7,17.4c1-.9,1.4-2.1,1.4-3.6s-.5-2.7-1.4-3.6c-1-.9-2.4-1.3-4.3-1.3h-5.1v9.8h5.1c1.9,0,3.3-.4,4.3-1.3Z"/><path class="cls-1" d="m130.5,33v10.6h-34.7V1.9h33.9v10.6h-20.1v4.9h17.6v10.1h-17.6v5.5h20.9Z"/><path class="cls-1" d="m177.1,1.9v41.7h-11.6l-15.8-18.9v18.9h-13.7V1.9h11.6l15.8,18.9V1.9h13.7Z"/><path class="cls-1" d="m211.6,5.6c3,2.5,4.5,5.9,4.5,10.3s-1.5,7.8-4.5,10.3c-3,2.5-7.1,3.7-12.3,3.7h-11.9v13.6h-3V1.9h15c5.2,0,9.4,1.2,12.3,3.7Zm-2.1,18.7c2.3-1.9,3.5-4.7,3.5-8.3s-1.2-6.4-3.5-8.4c-2.3-2-5.7-2.9-10.2-2.9h-11.9v22.6h11.9c4.4,0,7.8-1,10.2-2.9Z"/><path class="cls-1" d="m233.5,41.1c-3.3-1.8-5.9-4.4-7.8-7.6-1.9-3.2-2.8-6.8-2.8-10.8s.9-7.6,2.8-10.8c1.9-3.2,4.5-5.7,7.8-7.6,3.3-1.8,7-2.8,11.1-2.8s7.8.9,11.1,2.7c3.3,1.8,5.9,4.3,7.8,7.6,1.9,3.2,2.8,6.8,2.8,10.8s-.9,7.6-2.8,10.8c-1.9,3.2-4.5,5.7-7.8,7.6-3.3,1.8-7,2.7-11.1,2.7s-7.8-.9-11.1-2.8Zm20.6-2.4c2.8-1.6,5-3.8,6.7-6.6,1.6-2.8,2.4-5.9,2.4-9.4s-.8-6.6-2.4-9.4c-1.6-2.8-3.9-5-6.7-6.6-2.8-1.6-6-2.4-9.5-2.4s-6.7.8-9.5,2.4c-2.8,1.6-5.1,3.8-6.7,6.6-1.6,2.8-2.4,5.9-2.4,9.4s.8,6.6,2.4,9.4c1.6,2.8,3.9,5,6.7,6.6,2.8,1.6,6,2.4,9.5,2.4s6.7-.8,9.5-2.4Z"/><path class="cls-1" d="m279.1,42.3c-2.8-1.1-4.9-2.4-6.5-4.1l1.4-2.3c1.5,1.5,3.4,2.8,5.9,3.8,2.5,1,5.1,1.5,7.8,1.5,4,0,7-.8,9-2.3,2-1.5,3-3.5,3-5.9s-.5-3.4-1.6-4.5-2.4-2-4-2.6c-1.6-.6-3.7-1.2-6.4-1.8-3.1-.8-5.5-1.5-7.4-2.2-1.8-.7-3.4-1.8-4.7-3.3-1.3-1.5-1.9-3.5-1.9-6s.5-3.9,1.6-5.6c1.1-1.7,2.7-3,4.9-4,2.2-1,5-1.5,8.3-1.5s4.6.3,6.8,1c2.2.7,4.1,1.6,5.8,2.7l-1.1,2.4c-1.7-1.2-3.5-2-5.5-2.6-2-.6-4-.9-5.9-.9-3.9,0-6.8.8-8.8,2.3-2,1.5-3,3.6-3,6s.5,3.4,1.6,4.5,2.4,2,4,2.6c1.6.6,3.8,1.2,6.5,1.9,3.1.8,5.5,1.5,7.3,2.2,1.8.7,3.4,1.8,4.7,3.2,1.3,1.5,1.9,3.4,1.9,5.9s-.5,3.9-1.6,5.5c-1.1,1.7-2.8,3-5,4-2.3,1-5,1.5-8.3,1.5s-6-.5-8.7-1.6Z"/><path class="cls-1" d="m44,10.6c-2-3.3-4.8-5.9-8.4-7.8-3.6-1.9-7.6-2.8-12.1-2.8s-8.5.9-12.1,2.8c-3.6,1.9-6.4,4.5-8.4,7.8-2,3.3-3,7.1-3,11.2s1,7.9,3,11.2c2,3.3,4.8,5.9,8.4,7.8s7.6,2.8,12.1,2.8,8.5-.9,12.1-2.8,6.4-4.5,8.4-7.8c2-3.3,3-7.1,3-11.2s-1-7.9-3-11.2Zm-21.3,21.7v-10.4l-9-5.5c1.8-3,5.2-5,9-5,5.8,0,10.5,4.7,10.5,10.5s-4.7,10.5-10.5,10.5Z"/></svg>

                </span>
                <p class="ml-3 font-bold text-white truncate border-l pl-6">
                    <span x-text="notificationText"></span> <span class="font-normal"> is currently being served</span>
                </p>
            </div>
            <div class="order-2 shrink-0 sm:order-3 sm:ml-3">
                <?= $block->getChildHtml('login-as-customer-notice-links') ?>
            </div>
        </div>
    </div>
</div>

<script>
    "use strict";

    function initLoginAsCustomer() {
        return {
            isVisible: false,
            adminUserId: null,
            websiteName: null,
            fullname: null,
            notificationText: '',
            receiveCustomerData: function receiveCustomerData(data) {
                if (data.customer) {
                    this.fullname = data.customer.fullname;
                }

                if (data.loggedAsCustomer) {
                    this.adminUserId = data.loggedAsCustomer.adminUserId;
                    this.websiteName = data.loggedAsCustomer.websiteName;
                }

                this.updateBanner();
            },

            updateBanner: function updateBanner() {
                this.isVisible = !!this.adminUserId;

                if (this.fullname !== undefined && this.websiteName !== undefined) {
                    this.notificationText = '<?=
                        $escaper->escapeHtml(__('<strong>%1</strong> '), ['<strong>']) ?>'
                        .replace('%1', this.fullname)
                        .replace('%2', this.websiteName);
                }
            }
        }
    }
</script>
